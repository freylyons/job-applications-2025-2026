"use strict";$(function(){function e(e){i.addClass("finished-loading").removeClass("jbe-sending").prop("disabled",!1);var a,t;if(e.alert_already_exists?a="Job alert with the same criteria already exists.":e.limit_reached?a="Too many Job Alerts, we only allow you to save "+e.limit_reached+" alerts.":e.invalid_location?(a=window.from_job_view?"Please enter a valid location":"Sorry, we could not locate "+$("#job-alert-location").val(),t=$("#job-alert-location")):e.invalid_email?(a="Please enter a valid email address",t=$("#job-alert-email")):e.empty_keywords?(a=o,t=l):a="An unknown error occurred",e.invalid_email||($(".create-alert__input-wrap:not(.create-alert__email)").show(),$(".create-alert__email").removeClass("visible")),t){var s={};return s[t.attr("name")]=a,n.showErrors(s)}r.text(a).show()}function a(){$(".create-alert__email").addClass("visible"),$(".create-alert__input-wrap:not(.create-alert__email)").hide()}var t,i=$("#create-jbe-submit"),r=$(".create-alert__error"),l=$("#job-alert-keywords"),o="Please enter keywords or a job title";$(document).ready(function(){var e;e=from_apply_success?path.replace(/apply$/,"sanitise",path):location.pathname+"/sanitise",$.ajax({url:e,success:function(e){var a=e.title;$("#job-alert-keywords").val(a)}})});var s=$("#create-jbe");s.on("submit",function(o){o.preventDefault(),i.removeClass("finished-loading"),r.hide();var n,c=$("#job-alert-email");if(s.find(":input:visible").valid()){if(c.length&&!(n=c.val()))return c.is(":visible")?c.trigger("blur"):(s.data("validator").cancelSubmit=1,a());if(!t){var d={event_name:event_context.startsWith("/job")?"ux_job_view_jbe_created":event_context.startsWith("Apply")?"ux_job_apply_jbe_created":"ux_alerts_jbe_created",email_address:user_email||n,keywords:$("#job-alert-keywords").val(),location:$("#job-alert-location").val(),within:$("#distance").val()+" miles"};push_jbe_created_event(d),t=!0}$.ajax({url:"/create-job-alert",type:"POST",data:{calculate_salary_range:1,category:l.val(),distance:$("#distance").val(),email:n,location:$("#job-alert-location").val(),original_url:window.location.href,soft_login:window.soft_login,mobile_view:$("#mobile-icons").is(":visible")}}).done(function(a){a.redirect_url?location.href=a.redirect_url:a.success_existing_candidate?($(".create-alert").addClass("create-alert--success"),$("#mobile-icons").is(":visible")&&$("html, body").animate({scrollTop:$(".create-alert").offset().top-10},200),$("#application-success").toggle()):e(a)}),i.prop("disabled",!0),setTimeout(function(){i.hasClass("finished-loading")||i.addClass("jbe-sending")},500)}});var n=s.validate({rules:{category:"required",email:"required"},messages:{category:o,email:{required:"Please enter an email address"}}});$(".create-alert__close").on("click",function(){$(".create-alert").slideUp(150)}),$("body").on("mousedown",".autocomplete-suggestion",function(){$("#job-alert-location").trigger("input")})});