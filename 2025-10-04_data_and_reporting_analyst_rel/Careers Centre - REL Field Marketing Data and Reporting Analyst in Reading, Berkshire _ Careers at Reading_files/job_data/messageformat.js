(function(a){function b(d,f){var e;if(d&&f){b.locale[d]=f}e=d=d||"en";f=f||b.locale[e=b.Utils.getFallbackLocale(d)];if(!f){f=f||b.locale.en;console.warn("Plural Function not found for locale:",d)}this.pluralFunc=f;this.locale=d;this.fallbackLocale=e}b.locale={en:function(d){if(d===1){return"one"}return"other"}};b.SafeString=function(d){this.string=d};b.SafeString.prototype.toString=function(){return this.string.toString()};b.Utils={numSub:function(d,e,f){return d.replace(/^#|[^\\]#/g,function(g){var h=g&&g.length===2?g.charAt(0):"";return h+'" + (function(){ var x = '+e+';\nif( isNaN(x) ){\nthrow new Error("MessageFormat: `"+lastkey_'+f+'+"` isnt a number.");\n}\nreturn x;\n})() + "'})},escapeExpression:function(f){var g={"\n":"\\n",'"':'\\"'},h=/[\n"]/g,e=/[\n"]/,d=function(i){return g[i]||"&amp;"};if(f instanceof b.SafeString){return f.toString()}else{if(f===null||f===false){return""}}if(!e.test(f)){return f}return f.replace(h,d)},getFallbackLocale:function(d){var e=d.indexOf("-")>=0?"-":"_";while(!b.locale.hasOwnProperty(d)){d=d.substring(0,d.lastIndexOf(e));if(d.length===0){return null}}return d}};var c=(function(){function e(f){return'"'+f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var d={parse:function(g,l){var f={start:r,messageFormatPattern:o,messageFormatPatternRight:B,messageFormatElement:s,elementFormat:m,pluralStyle:H,selectStyle:M,pluralFormatPattern:w,offsetPattern:N,selectFormatPattern:C,pluralForms:A,stringKey:G,string:I,id:x,chars:K,"char":E,digits:t,hexDigit:k,_:D,whitespace:j};if(l!==undefined){if(f[l]===undefined){throw new Error("Invalid rule name: "+e(l)+".")}}else{l="start"}var z=0;var L=0;var h=0;var n=[];function O(Q,U,S){var P=Q;var T=S-Q.length;for(var R=0;R<T;R++){P=U+P}return P}function u(R){var Q=R.charCodeAt(0);var P;var S;if(Q<=255){P="x";S=2}else{P="u";S=4}return"\\"+P+O(Q.toString(16).toUpperCase(),"0",S)}function p(P){if(z<h){return}if(z>h){h=z;n=[]}n.push(P)}function r(){var P;var Q;Q=z;P=o();if(P!==null){P=(function(R,S){return{type:"program",program:S}})(Q,P)}if(P===null){z=Q}return P}function o(){var S,Q,P;var T,R;T=z;R=z;S=I();if(S!==null){Q=[];P=B();while(P!==null){Q.push(P);P=B()}if(Q!==null){S=[S,Q]}else{S=null;z=R}}else{S=null;z=R}if(S!==null){S=(function(Y,X,U){var V=[];if(X&&X.val){V.push(X)}for(var W in U){if(U.hasOwnProperty(W)){V.push(U[W])}}return{type:"messageFormatPattern",statements:V}})(T,S[0],S[1])}if(S===null){z=T}return S}function B(){var V,T,S,R,Q,P;var W,U;W=z;U=z;if(g.charCodeAt(z)===123){V="{";z++}else{V=null;if(L===0){p('"{"')}}if(V!==null){T=D();if(T!==null){S=s();if(S!==null){R=D();if(R!==null){if(g.charCodeAt(z)===125){Q="}";z++}else{Q=null;if(L===0){p('"}"')}}if(Q!==null){P=I();if(P!==null){V=[V,T,S,R,Q,P]}else{V=null;z=U}}else{V=null;z=U}}else{V=null;z=U}}else{V=null;z=U}}else{V=null;z=U}}else{V=null;z=U}if(V!==null){V=(function(aa,Z,Y){var X=[];if(Z){X.push(Z)}if(Y&&Y.val){X.push(Y)}return{type:"messageFormatPatternRight",statements:X}})(W,V[2],V[5])}if(V===null){z=W}return V}function s(){var T,R,P;var U,S,Q;U=z;S=z;T=x();if(T!==null){Q=z;if(g.charCodeAt(z)===44){R=",";z++}else{R=null;if(L===0){p('","')}}if(R!==null){P=m();if(P!==null){R=[R,P]}else{R=null;z=Q}}else{R=null;z=Q}R=R!==null?R:"";if(R!==null){T=[T,R]}else{T=null;z=S}}else{T=null;z=S}if(T!==null){T=(function(Y,V,X){var W={type:"messageFormatElement",argumentIndex:V};if(X&&X.length){W.elementFormat=X[1]}else{W.output=true}return W})(U,T[0],T[1])}if(T===null){z=U}return T}function m(){var V,U,T,S,R,Q,P;var X,W;X=z;W=z;V=D();if(V!==null){if(g.substr(z,6)==="plural"){U="plural";z+=6}else{U=null;if(L===0){p('"plural"')}}if(U!==null){T=D();if(T!==null){if(g.charCodeAt(z)===44){S=",";z++}else{S=null;if(L===0){p('","')}}if(S!==null){R=D();if(R!==null){Q=H();if(Q!==null){P=D();if(P!==null){V=[V,U,T,S,R,Q,P]}else{V=null;z=W}}else{V=null;z=W}}else{V=null;z=W}}else{V=null;z=W}}else{V=null;z=W}}else{V=null;z=W}}else{V=null;z=W}if(V!==null){V=(function(aa,Y,Z){return{type:"elementFormat",key:Y,val:Z.val}})(X,V[1],V[5])}if(V===null){z=X}if(V===null){X=z;W=z;V=D();if(V!==null){if(g.substr(z,6)==="select"){U="select";z+=6}else{U=null;if(L===0){p('"select"')}}if(U!==null){T=D();if(T!==null){if(g.charCodeAt(z)===44){S=",";z++}else{S=null;if(L===0){p('","')}}if(S!==null){R=D();if(R!==null){Q=M();if(Q!==null){P=D();if(P!==null){V=[V,U,T,S,R,Q,P]}else{V=null;z=W}}else{V=null;z=W}}else{V=null;z=W}}else{V=null;z=W}}else{V=null;z=W}}else{V=null;z=W}}else{V=null;z=W}if(V!==null){V=(function(aa,Y,Z){return{type:"elementFormat",key:Y,val:Z.val}})(X,V[1],V[5])}if(V===null){z=X}}return V}function H(){var P;var Q;Q=z;P=w();if(P!==null){P=(function(S,R){return{type:"pluralStyle",val:R}})(Q,P)}if(P===null){z=Q}return P}function M(){var P;var Q;Q=z;P=C();if(P!==null){P=(function(S,R){return{type:"selectStyle",val:R}})(Q,P)}if(P===null){z=Q}return P}function w(){var S,Q,P;var T,R;T=z;R=z;S=N();S=S!==null?S:"";if(S!==null){Q=[];P=A();while(P!==null){Q.push(P);P=A()}if(Q!==null){S=[S,Q]}else{S=null;z=R}}else{S=null;z=R}if(S!==null){S=(function(W,X,U){var V={type:"pluralFormatPattern",pluralForms:U};if(X){V.offset=X}else{V.offset=0}return V})(T,S[0],S[1])}if(S===null){z=T}return S}function N(){var V,U,T,S,R,Q,P;var X,W;X=z;W=z;V=D();if(V!==null){if(g.substr(z,6)==="offset"){U="offset";z+=6}else{U=null;if(L===0){p('"offset"')}}if(U!==null){T=D();if(T!==null){if(g.charCodeAt(z)===58){S=":";z++}else{S=null;if(L===0){p('":"')}}if(S!==null){R=D();if(R!==null){Q=t();if(Q!==null){P=D();if(P!==null){V=[V,U,T,S,R,Q,P]}else{V=null;z=W}}else{V=null;z=W}}else{V=null;z=W}}else{V=null;z=W}}else{V=null;z=W}}else{V=null;z=W}}else{V=null;z=W}if(V!==null){V=(function(Z,Y){return Y})(X,V[5])}if(V===null){z=X}return V}function C(){var Q,P;var R;R=z;Q=[];P=A();while(P!==null){Q.push(P);P=A()}if(Q!==null){Q=(function(T,S){return{type:"selectFormatPattern",pluralForms:S}})(R,Q)}if(Q===null){z=R}return Q}function A(){var W,V,U,T,S,R,Q,P;var Y,X;Y=z;X=z;W=D();if(W!==null){V=G();if(V!==null){U=D();if(U!==null){if(g.charCodeAt(z)===123){T="{";z++}else{T=null;if(L===0){p('"{"')}}if(T!==null){S=D();if(S!==null){R=o();if(R!==null){Q=D();if(Q!==null){if(g.charCodeAt(z)===125){P="}";z++}else{P=null;if(L===0){p('"}"')}}if(P!==null){W=[W,V,U,T,S,R,Q,P]}else{W=null;z=X}}else{W=null;z=X}}else{W=null;z=X}}else{W=null;z=X}}else{W=null;z=X}}else{W=null;z=X}}else{W=null;z=X}}else{W=null;z=X}if(W!==null){W=(function(ab,Z,aa){return{type:"pluralForms",key:Z,val:aa}})(Y,W[1],W[5])}if(W===null){z=Y}return W}function G(){var R,P;var S,Q;S=z;R=x();if(R!==null){R=(function(U,T){return T})(S,R)}if(R===null){z=S}if(R===null){S=z;Q=z;if(g.charCodeAt(z)===61){R="=";z++}else{R=null;if(L===0){p('"="')}}if(R!==null){P=t();if(P!==null){R=[R,P]}else{R=null;z=Q}}else{R=null;z=Q}if(R!==null){R=(function(U,T){return T})(S,R[1])}if(R===null){z=S}}return R}function I(){var V,T,R,Q,P;var W,U,S;W=z;U=z;V=D();if(V!==null){T=[];S=z;R=D();if(R!==null){Q=K();if(Q!==null){P=D();if(P!==null){R=[R,Q,P]}else{R=null;z=S}}else{R=null;z=S}}else{R=null;z=S}while(R!==null){T.push(R);S=z;R=D();if(R!==null){Q=K();if(Q!==null){P=D();if(P!==null){R=[R,Q,P]}else{R=null;z=S}}else{R=null;z=S}}else{R=null;z=S}}if(T!==null){V=[V,T]}else{V=null;z=U}}else{V=null;z=U}if(V!==null){V=(function(ac,X,ab){var aa=[];for(var Z=0;Z<ab.length;++Z){for(var Y=0;Y<ab[Z].length;++Y){aa.push(ab[Z][Y])}}return{type:"string",val:X+aa.join("")}})(W,V[0],V[1])}if(V===null){z=W}return V}function x(){var T,R,Q,P;var U,S;U=z;S=z;T=D();if(T!==null){if(/^[a-zA-Z$_]/.test(g.charAt(z))){R=g.charAt(z);z++}else{R=null;if(L===0){p("[a-zA-Z$_]")}}if(R!==null){Q=[];if(/^[^ \t\n\r,.+={}]/.test(g.charAt(z))){P=g.charAt(z);z++}else{P=null;if(L===0){p("[^ \\t\\n\\r,.+={}]")}}while(P!==null){Q.push(P);if(/^[^ \t\n\r,.+={}]/.test(g.charAt(z))){P=g.charAt(z);z++}else{P=null;if(L===0){p("[^ \\t\\n\\r,.+={}]")}}}if(Q!==null){P=D();if(P!==null){T=[T,R,Q,P]}else{T=null;z=S}}else{T=null;z=S}}else{T=null;z=S}}else{T=null;z=S}if(T!==null){T=(function(X,W,V){return W+(V?V.join(""):"")})(U,T[1],T[2])}if(T===null){z=U}return T}function K(){var Q,P;var R;R=z;P=E();if(P!==null){Q=[];while(P!==null){Q.push(P);P=E()}}else{Q=null}if(Q!==null){Q=(function(T,S){return S.join("")})(R,Q)}if(Q===null){z=R}return Q}function E(){var U,S,R,Q,P;var V,T;V=z;if(/^[^{}\\\0-\x1F \t\n\r]/.test(g.charAt(z))){U=g.charAt(z);z++}else{U=null;if(L===0){p("[^{}\\\\\\0-\\x1F \\t\\n\\r]")}}if(U!==null){U=(function(X,W){return W})(V,U)}if(U===null){z=V}if(U===null){V=z;if(g.substr(z,2)==="\\#"){U="\\#";z+=2}else{U=null;if(L===0){p('"\\\\#"')}}if(U!==null){U=(function(W){return"\\#"})(V)}if(U===null){z=V}if(U===null){V=z;if(g.substr(z,2)==="\\{"){U="\\{";z+=2}else{U=null;if(L===0){p('"\\\\{"')}}if(U!==null){U=(function(W){return"\u007B"})(V)}if(U===null){z=V}if(U===null){V=z;if(g.substr(z,2)==="\\}"){U="\\}";z+=2}else{U=null;if(L===0){p('"\\\\}"')}}if(U!==null){U=(function(W){return"\u007D"})(V)}if(U===null){z=V}if(U===null){V=z;T=z;if(g.substr(z,2)==="\\u"){U="\\u";z+=2}else{U=null;if(L===0){p('"\\\\u"')}}if(U!==null){S=k();if(S!==null){R=k();if(R!==null){Q=k();if(Q!==null){P=k();if(P!==null){U=[U,S,R,Q,P]}else{U=null;z=T}}else{U=null;z=T}}else{U=null;z=T}}else{U=null;z=T}}else{U=null;z=T}if(U!==null){U=(function(aa,Z,Y,X,W){return String.fromCharCode(parseInt("0x"+Z+Y+X+W))})(V,U[1],U[2],U[3],U[4])}if(U===null){z=V}}}}}return U}function t(){var Q,P;var R;R=z;if(/^[0-9]/.test(g.charAt(z))){P=g.charAt(z);z++}else{P=null;if(L===0){p("[0-9]")}}if(P!==null){Q=[];while(P!==null){Q.push(P);if(/^[0-9]/.test(g.charAt(z))){P=g.charAt(z);z++}else{P=null;if(L===0){p("[0-9]")}}}}else{Q=null}if(Q!==null){Q=(function(T,S){return parseInt((S.join("")),10)})(R,Q)}if(Q===null){z=R}return Q}function k(){var P;if(/^[0-9a-fA-F]/.test(g.charAt(z))){P=g.charAt(z);z++}else{P=null;if(L===0){p("[0-9a-fA-F]")}}return P}function D(){var Q,P;var R;L++;R=z;Q=[];P=j();while(P!==null){Q.push(P);P=j()}if(Q!==null){Q=(function(T,S){return S.join("")})(R,Q)}if(Q===null){z=R}L--;if(L===0&&Q===null){p("whitespace")}return Q}function j(){var P;if(/^[ \t\n\r]/.test(g.charAt(z))){P=g.charAt(z);z++}else{P=null;if(L===0){p("[ \\t\\n\\r]")}}return P}function v(R){R.sort();var S=null;var Q=[];for(var P=0;P<R.length;P++){if(R[P]!==S){Q.push(R[P]);S=R[P]}}return Q}function y(){var P=1;var S=1;var T=false;for(var Q=0;Q<Math.max(z,h);Q++){var R=g.charAt(Q);if(R==="\n"){if(!T){P++}S=1;T=false}else{if(R==="\r"||R==="\u2028"||R==="\u2029"){P++;S=1;T=true}else{S++;T=false}}}return{line:P,column:S}}var q=f[l]();if(q===null||z!==g.length){var F=Math.max(z,h);var i=F<g.length?g.charAt(F):null;var J=y();throw new this.SyntaxError(v(n),i,F,J.line,J.column)}return q},toSource:function(){return this._source}};d.SyntaxError=function(i,j,k,g,h){function f(n,o){var l,m;switch(n.length){case 0:l="end of input";break;case 1:l=n[0];break;default:l=n.slice(0,n.length-1).join(", ")+" or "+n[n.length-1]}m=o?e(o):"end of input";return"Expected "+l+" but "+m+" found."}this.name="SyntaxError";this.expected=i;this.found=j;this.message=f(i,j);this.offset=k;this.line=g;this.column=h};d.SyntaxError.prototype=Error.prototype;return d})();b.prototype.parse=function(){return c.parse.apply(c,arguments)};b.prototype.precompile=function(d){var e=this,g=false,f={begin:'function(d){\nvar r = "";\n',end:"return r;\n}"};function h(j,o){o=o||{};var n="",l,k,m;switch(j.type){case"program":return h(j.program);case"messageFormatPattern":for(l=0;l<j.statements.length;++l){n+=h(j.statements[l],o)}return f.begin+n+f.end;case"messageFormatPatternRight":for(l=0;l<j.statements.length;++l){n+=h(j.statements[l],o)}return n;case"messageFormatElement":o.pf_count=o.pf_count||0;n+='if(!d){\nthrow new Error("MessageFormat: No data passed to function.");\n}\n';if(j.output){n+='r += d["'+j.argumentIndex+'"];\n'}else{m="lastkey_"+(o.pf_count+1);n+="var "+m+' = "'+j.argumentIndex+'";\n';n+="var k_"+(o.pf_count+1)+"=d["+m+"];\n";n+=h(j.elementFormat,o)}return n;case"elementFormat":if(j.key==="select"){n+=h(j.val,o);n+="r += (pf_"+o.pf_count+"[ k_"+(o.pf_count+1)+" ] || pf_"+o.pf_count+'[ "other" ])( d );\n'}else{if(j.key==="plural"){n+=h(j.val,o);n+="if ( pf_"+(o.pf_count)+"[ k_"+(o.pf_count+1)+' + "" ] ) {\n';n+="r += pf_"+o.pf_count+"[ k_"+(o.pf_count+1)+' + "" ]( d ); \n';n+="}\nelse {\n";n+="r += (pf_"+o.pf_count+'[ MessageFormat.locale["'+e.fallbackLocale+'"]( k_'+(o.pf_count+1)+" - off_"+(o.pf_count)+" ) ] || pf_"+o.pf_count+'[ "other" ] )( d );\n';n+="}\n"}}return n;case"pluralFormatPattern":o.pf_count=o.pf_count||0;n+="var off_"+o.pf_count+" = "+j.offset+";\n";n+="var pf_"+o.pf_count+" = { \n";g=true;for(l=0;l<j.pluralForms.length;++l){if(j.pluralForms[l].key==="other"){g=false}if(k){n+=",\n"}else{k=1}n+='"'+j.pluralForms[l].key+'" : '+h(j.pluralForms[l].val,(function(){var i=JSON.parse(JSON.stringify(o));i.pf_count++;return i})())}n+="\n};\n";if(g){throw new Error("No 'other' form found in pluralFormatPattern "+o.pf_count)}return n;case"selectFormatPattern":o.pf_count=o.pf_count||0;n+="var off_"+o.pf_count+" = 0;\n";n+="var pf_"+o.pf_count+" = { \n";g=true;for(l=0;l<j.pluralForms.length;++l){if(j.pluralForms[l].key==="other"){g=false}if(k){n+=",\n"}else{k=1}n+='"'+j.pluralForms[l].key+'" : '+h(j.pluralForms[l].val,(function(){var i=JSON.parse(JSON.stringify(o));i.pf_count++;return i})())}n+="\n};\n";if(g){throw new Error("No 'other' form found in selectFormatPattern "+o.pf_count)}return n;case"string":return'r += "'+b.Utils.numSub(b.Utils.escapeExpression(j.val),"k_"+o.pf_count+" - off_"+(o.pf_count-1),o.pf_count)+'";\n';default:throw new Error("Bad AST type: "+j.type)}}return h(d)};b.prototype.compile=function(d){return(new Function("MessageFormat","return "+this.precompile(this.parse(d))))(b)};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=b}exports.MessageFormat=b}else{if(typeof define==="function"&&define.amd){define(function(){return b})}else{a.MessageFormat=b}}})(this);