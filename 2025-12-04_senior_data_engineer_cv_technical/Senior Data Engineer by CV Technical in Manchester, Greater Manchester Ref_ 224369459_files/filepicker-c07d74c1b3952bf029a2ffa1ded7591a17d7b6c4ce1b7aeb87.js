"use strict";function create_element(e,o,i){return $(document.createElement(e)).attr({id:o,"class":i})}function check_box_access_token(e){$.ajax({url:"https://api.box.com/2.0/users/me",dataType:"json",xhrFields:{withCredentials:!1},method:"GET",beforeSend:function(o){o.setRequestHeader("Authorization","Bearer "+e)},success:function(){box_access_token=e},error:function(){window.localStorage.removeItem("cvl_box_access_token")}})}function check_dropbox_access_token(e){$.ajax({url:"https://api.dropboxapi.com/2/users/get_current_account",dataType:"json",headers:{Authorization:"Bearer "+e},method:"POST",success:function(){dropbox_access_token=e},error:function(){window.localStorage.removeItem("cvl_dropbox_access_token")}})}function check_googledrive_access_token(e){$.ajax({url:"https://www.googleapis.com/oauth2/v1/tokeninfo?access_token="+e,dataType:"json",method:"GET",success:function(o){o.expires_in>60&&(googledrive_access_token=e)},error:function(){window.localStorage.removeItem("cvl_googledrive_access_token")}})}function check_onedrive_access_token(e){$.ajax({url:"https://apis.live.net/v5.0/me?access_token="+e,dataType:"json",method:"GET",success:function(){onedrive_access_token=e},error:function(){window.localStorage.removeItem("cvl_onedrive_access_token")}})}function open_popup(e){activeFilePicker=e,$overlay.fadeIn(300),setTimeout(function(){$popup.fadeIn(200),$("body").css("overflow","hidden")},300)}function hide_popup(){$popup.fadeOut(100),$overlay.fadeOut(300),box_prev_folder=[],dropbox_prev_path=[],onedrive_prev_folder=[],googledrive_prev_folder=[],opening_cloud="0",setTimeout(function(){$picker.text(""),add_filepicker_user_info("",""),$user_info.hide(),$breadcrumbs.text(""),have_box_account_info=!1,have_dropbox_account_info=!1,have_onedrive_account_info=!1,have_googledrive_account_info=!1,$choose_file.data({name:"",path:""}).removeClass("filepicker-chosen"),$("body").css("overflow","")},300)}function show_loading_div(e){$loading_div.children("p").text(e),$loading_div.fadeIn(300)}function hide_loading_div(){$loading_div.fadeOut(300)}function add_filepicker_user_info(e,o){$user_info_name.text(e),$user_info_dropdown_email.text(o||""),$user_info.fadeIn(300)}function show_error(e){var o=create_element("span","","filepicker-error").text(e);$picker.prepend(o)}function load_picker_auth(e){switch(e){case"box":fp_picker_using="box",$("#filepicker-picker").text("Box"),$picker_top.attr("class","box-filepicker"),box_access_token?get_box_list_json():(show_loading_div("Please sign in to Box"),auth_window=window.open(box_auth_url,"",auth_window_options));break;case"dropbox":$("#filepicker-picker").text("Dropbox"),$picker_top.attr("class","dropbox-filepicker"),dropbox_access_token?get_dropbox_list_json():(show_loading_div("Please sign in to Dropbox"),auth_window=window.open(dropbox_auth_url,"",auth_window_options));break;case"googledrive":$("#filepicker-picker").text("Google Drive"),$picker_top.attr("class","googledrive-filepicker"),googledrive_access_token?get_googledrive_list_json():(show_loading_div("Please sign in to Google Drive"),auth_window=window.open(googledrive_auth_url,"",auth_window_options));break;case"onedrive":$("#filepicker-picker").text("OneDrive"),$picker_top.attr("class","onedrive-filepicker"),onedrive_access_token?get_onedrive_list_json():(show_loading_div("Please sign in to Onedrive"),auth_window=window.open(onedrive_auth_url,"",auth_window_options))}}function swap_box_auth_code(e){auth_window&&auth_window.close(),$.ajax({url:"https://api.box.com/oauth2/token",data:{grant_type:"authorization_code",code:e,client_id:box_client_id,client_secret:box_client_secret},xhrFields:{withCredentials:!1},type:"POST",success:function(e){e.access_token?open_box_picker(e.access_token):alert("There was an error syncing your Box account. Please try again")},error:function(){alert("There was an error syncing your Box account. Please try again")}})}function open_box_picker(e){auth_window&&auth_window.close(),box_access_token=e,window.localStorage.cvl_box_access_token=e,get_box_list_json()}function box_picker_denied(){auth_window&&auth_window.close(),alert("Please allow CV-Library access to your Box file list in order to upload your CV via Box")}function get_box_user_info(){var e=$.Deferred();return $.ajax({url:"https://api.box.com/2.0/users/me",dataType:"json",xhrFields:{withCredentials:!1},method:"GET",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+box_access_token)},success:function(o){add_filepicker_user_info(o.name,o.login),have_box_account_info=!0,e.resolve()},error:function(){e.resolve()}}),e}function get_box_list_json(e,o){var i=e;i&&""!=i||(i=0);var t="https://api.box.com/2.0/folders/"+i+"/items?limit=1000&fields=extension,name,modified_at,download_url,size";show_loading_div("Loading documents"),$.ajax({url:t,dataType:"json",xhrFields:{withCredentials:!1},method:"GET",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+box_access_token)},success:function(e){box_prev_folder.push({path:i,name:o||"Box"}),generate_box_file_list(e.entries),0==i?($breadcrumbs.hide(),$picker.addClass("first-page")):($breadcrumbs.show(),$picker.removeClass("first-page")),have_box_account_info?hide_loading_div():get_box_user_info().done(function(){hide_loading_div()})},error:function(){hide_loading_div(),box_access_token?auth_window=window.open(box_auth_url,"",auth_window_options):alert("There was an error retrieving your Box documents. Please try again.")}})}function generate_box_file_list(e){var o=[];$.each(e,function(e,i){if("folder"==i.type){var t=build_box_folder(i);o.push(t)}else if("file"==i.type){var r,n=i.extension,a=i.name.split(".").shift();Valid.IsInvalidCV(a)?(r=build_unsupported_dropbox_file(i),o.push(r)):n&&(n.match(/^(pdf|txt|rtf|doc|docx|odt|wps)$/i)?(r=build_box_file(i),o.push(r)):(r=build_unsupported_box_file(i),o.push(r)))}}),$picker.text(""),$.each(o,function(e,o){$picker.append(o)}),generate_box_breadcrumbs(),o.length<1&&show_error(box_prev_folder.length>1?"We couldn't find any documents in this folder":"We couldn't find any documents in your box account")}function generate_box_breadcrumbs(){$breadcrumbs.text(""),$.each(box_prev_folder,function(e,o){var i=e>0?o.name:"Box",t=$("<span>",{"data-index":e,"class":"filepicker-breadcrumb"}).text(i);e>0&&$breadcrumbs.append("<span>&gt</span>"),$breadcrumbs.append(t)})}function build_box_folder(e){var o=create_element("h3","","box-folder-title").text(e.name),i=create_element("span","","filepicker-thumb").html('<img src="/images/filepicker-folder-thumb.png">'),t=create_element("div","","box-folder").data({folder_path:e.id,folder_name:e.name});return t.append(i,o),t}function build_box_file(e){var o=e.extension,i=create_element("h3","","box-doc-title").text(e.name),t=$("<img>",{src:encodeURI("/images/filepicker-"+o+"-thumb.png")}),r=create_element("span","","filepicker-thumb").html(t),n=create_element("span","","filepicker-checkbox"),a=e.modified_at,d=a.split("T").shift();d=d.split("-"),d.reverse();var c=d.join("-"),l=create_element("p","","box-doc-date").text("Last modified: "+c),s=create_element("div","","box-doc").data({download_link:e.download_url,name:e.name,size:e.size});return s.append(r,i,l,n),s}function build_unsupported_box_file(e){var o=create_element("h3","","box-doc-title").text(e.name),i=create_element("span","","filepicker-thumb").html('<img src="/images/filepicker-unsupported-thumb.png">'),t=create_element("span","","filepicker-unsupported").text("We don't support this file type"),r=e.modified_at,n=r.split("T").shift();n=n.split("-"),n.reverse();var a=n.join("-"),d=create_element("p","","box-doc-date").text("Last modified: "+a),c=create_element("div","","box-doc unsupported");return c.append(i,o,d,t),c}function logout_box(){box_access_token=null,window.localStorage.removeItem("cvl_box_access_token"),show_loading_div("Logging out from Box");var e=$(document.createElement("iframe")).attr({"class":"logout-frame",src:"https://app.box.com/logout"});e.on("load",function(){$(this).remove(),hide_loading_div(),hide_popup()}),$("body").append(e)}function open_dropbox_picker(e){auth_window&&auth_window.close(),dropbox_access_token=e,window.localStorage.cvl_dropbox_access_token=e,get_dropbox_list_json()}function dropbox_picker_denied(){auth_window&&auth_window.close(),alert("Please allow CV-Library access to your Dropbox file list in order to upload your CV via Dropbox")}function get_dropbox_user_info(){var e=$.Deferred();return $.ajax({url:"https://api.dropboxapi.com/2/users/get_current_account",dataType:"json",headers:{Authorization:"Bearer "+dropbox_access_token},method:"POST",success:function(o){add_filepicker_user_info(o.name.display_name,o.email),have_dropbox_account_info=!0,e.resolve()},error:function(o){console.log(o),e.resolve()}}),e}function get_dropbox_list_json(e){show_loading_div("Loading documents");var o=e&&""!=e?e:"";$.ajax({url:"https://api.dropboxapi.com/2/files/list_folder",data:JSON.stringify({path:o}),dataType:"json",headers:{Authorization:"Bearer "+dropbox_access_token,"Content-Type":"application/json"},method:"POST",success:function(e){dropbox_prev_path.push(o),generate_dropbox_file_list(e.entries),dropbox_prev_path.length<2?($breadcrumbs.hide(),$picker.addClass("first-page")):($breadcrumbs.show(),$picker.removeClass("first-page")),have_dropbox_account_info?hide_loading_div():get_dropbox_user_info().done(function(){hide_loading_div()})},error:function(){hide_loading_div(),dropbox_access_token?auth_window=window.open(dropbox_auth_url,"",auth_window_options):alert("There was an error retrieving your Dropbox documents. Please try again.")}})}function generate_dropbox_file_list(e){var o,i=[];$.each(e,function(e,t){if("folder"==t[".tag"]){var r=build_dropbox_folder(t);i.push(r)}else{var n=t.path_display.split("/").pop(),a=t.name.split(".").pop();Valid.IsInvalidCV(n)?(o=build_unsupported_dropbox_file(t),i.push(o)):a&&(a.match(/pdf|txt|rtf|doc|docx|odt|wps/i)?(o=build_dropbox_file(t),i.push(o)):(o=build_unsupported_dropbox_file(t),i.push(o)))}}),$picker.text(""),$.each(i,function(e,o){$picker.append(o)}),generate_dropbox_breadcrumbs(),i.length<1&&show_error(dropbox_prev_path.length>1?"We couldn't find any documents in this folder":"We couldn't find any documents in your Dropbox account")}function generate_dropbox_breadcrumbs(){$breadcrumbs.text(""),$.each(dropbox_prev_path,function(e,o){var i=e>0?o.substr(parseInt(o.lastIndexOf("/")+1),o.length):"Dropbox",t=$("<span>",{"data-index":e,"class":"filepicker-breadcrumb"}).text(i);e>0&&$breadcrumbs.append("<span>&gt</span>"),$breadcrumbs.append(t)})}function pad(e){return e>=10?e:"0"+e}function build_dropbox_file(e){var o=e.name.split(".").pop().toLowerCase(),i=e.path_display.split("/").pop(),t=create_element("h3","","dropbox-doc-title").text(i),r="/images/"+dropbox_thumbnails[o]+".png",n=create_element("span","","filepicker-thumb").html($("<img>",{src:r})),a=create_element("span","","filepicker-checkbox"),d=e.server_modified,c=new Date(d),l=c.getFullYear(),s=pad(parseInt(c.getMonth()+1)),p=pad(c.getDate()),_=p+"-"+s+"-"+l,u=create_element("p","","dropbox-doc-date").text("Last modified: "+_),f=create_element("div","","dropbox-doc").data({download_link:e.path_display,name:i,size:e.size});return f.append(n,t,u,a),f}function build_unsupported_dropbox_file(e){var o=e.path_display.split("/").pop(),i=create_element("h3","","dropbox-doc-title").text(o),t=create_element("span","","filepicker-thumb").html('<img src="//static.cv-library.co.uk/images/filepicker-unsupported-thumb.png">'),r=create_element("span","","filepicker-unsupported").text("We don't support this file type"),n=e.server_modified,a=new Date(n),d=a.getFullYear(),c=pad(parseInt(a.getMonth()+1)),l=pad(a.getDate()),s=l+"-"+c+"-"+d,p=create_element("p","","dropbox-doc-date").text("Last modified: "+s),_=create_element("div","","dropbox-doc unsupported");return _.append(t,i,p,r),_}function build_dropbox_folder(e){var o=e.path_display.substr(e.path_display.lastIndexOf("/")+1,e.path_display.length),i=create_element("h3","","dropbox-folder-title").text(o),t=create_element("span","","filepicker-thumb").html('<img src="//static.cv-library.co.uk/images/filepicker-folder-thumb.png">'),r=create_element("div","","dropbox-folder").data("path",e.path_display);return r.append(t,i),r}function fetch_dropbox_download_link(e,o){show_loading_div("Fetching document"),$.ajax({url:"https://api.dropboxapi.com/2/files/get_temporary_link",data:JSON.stringify({path:e}),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+dropbox_access_token,"Content-Type":"application/json"}}).done(function(e){hide_loading_div(),dropbox_prev_path=[],set_file_name(o),$("#cv_name_nice").val(o),activeFilePicker.$googledrive_url.val(""),activeFilePicker.$onedrive_url.val(""),resetFormElement(activeFilePicker.$file_input,o),activeFilePicker.$dropbox_url.val(e.link).trigger("change"),hide_popup(),hide_upload_later()}).fail(function(e){console.log(e),hide_loading_div(),alert("We were unable to fetch that document. Please try again.")})}function logout_dropbox(){dropbox_access_token=null,window.localStorage.removeItem("cvl_dropbox_access_token"),show_loading_div("Logging out from Dropbox");var e=$(document.createElement("iframe")).attr({"class":"logout-frame",src:"https://www.dropbox.com/logout"});e.on("load",function(){$(this).remove(),hide_loading_div(),hide_popup()}),$("body").append(e)}function open_googledrive_picker(e){auth_window&&auth_window.close(),googledrive_access_token=e,window.localStorage.cvl_googledrive_access_token=e,get_googledrive_list_json()}function googledrive_picker_denied(){auth_window&&auth_window.close(),alert("Please allow CV-Library access to your Google Drive file list in order to upload your CV via Google Drive")}function get_googledrive_user_info(){var e=$.Deferred();return $.ajax({url:"https://www.googleapis.com/oauth2/v2/userinfo?alt=json&access_token="+googledrive_access_token,type:"GET",dataType:"JSON",success:function(o){add_filepicker_user_info(o.name,o.email),have_googledrive_account_info=!0,e.resolve()},error:function(o){console.log(o),e.resolve()}}),e}function get_googledrive_list_json(e,o){auth_window&&auth_window.close(),show_loading_div("Loading documents");var i;o?(googledrive_items=[],i="https://www.googleapis.com/drive/v2/files?corpus=DEFAULT&maxResults=1000&orderBy=folder,title&q=%27"+o+"%27+in+parents+and+trashed+%3D+false+and+(mimeType+contains+%22word%22+or+mimeType+contains+%22folder%22+or+mimeType+contains+%22pdf%22+or+mimeType+contains+%22docx%22+or+mimeType+contains+%22application%2Fvnd.google-apps.document%22)&spaces=drive&fields=items(downloadUrl%2CexportLinks%2CexplicitlyTrashed%2CfileExtension%2CfileSize%2CfullFileExtension%2CiconLink%2Cid%2CmimeType%2CmodifiedDate%2CoriginalFilename%2CownedByMe%2Cparents(id%2CisRoot)%2Cshared%2Cspaces%2Ctitle%2CwebContentLink)%2CnextLink%2CnextPageToken&access_token="+googledrive_access_token):e?i=e+"&access_token="+googledrive_access_token:(googledrive_items=[],googledrive_prev_folder=[],googledrive_prev_folder.push({path:!1,name:" "}),i="https://www.googleapis.com/drive/v2/files?corpus=DEFAULT&maxResults=1000&orderBy=folder,title&q=trashed+%3D+false+and+(mimeType+contains+%22word%22+or+mimeType+contains+%22folder%22+or+mimeType+contains+%22pdf%22+or+mimeType+contains+%22docx%22+or+mimeType+contains+%22application%2Fvnd.google-apps.document%22)&spaces=drive&fields=items(downloadUrl%2CexportLinks%2CexplicitlyTrashed%2CfileExtension%2CfileSize%2CfullFileExtension%2CiconLink%2Cid%2CmimeType%2CmodifiedDate%2CoriginalFilename%2CownedByMe%2Cparents(id%2CisRoot)%2Cshared%2Cspaces%2Ctitle%2CwebContentLink)%2CnextLink%2CnextPageToken&access_token="+googledrive_access_token),$.ajax({url:i,type:"GET",dataType:"JSON",success:function(e){generate_googledrive_file_list(e),$breadcrumbs.hide(),$picker.addClass("first-page"),googledrive_prev_folder.length<2?($breadcrumbs.hide(),$picker.addClass("first-page")):($breadcrumbs.show(),$picker.removeClass("first-page")),have_googledrive_account_info?hide_loading_div():get_googledrive_user_info().done(function(){hide_loading_div()})},error:function(){googledrive_access_token?auth_window=window.open(googledrive_auth_url,"",auth_window_options):(hide_loading_div(),alert("There was a problem retrieving your Google Drive documents. Please try again."))}})}function generate_googledrive_file_list(e){var o,i=[];e.items&&e.items.length>0&&(googledrive_items=googledrive_items.concat(e.items)),e.nextLink?get_googledrive_list_json(e.nextLink):($.each(googledrive_items,function(e,t){if(t.explicitlyTrashed)return!0;if(googledrive_prev_folder.length<2&&t.parents[0]&&!t.parents[0].isRoot)return!0;if(t.mimeType&&"application/vnd.google-apps.folder"==t.mimeType){var r=build_googledrive_folder(t);i.push(r)}Valid.IsInvalidCV(t.title)?(o=build_unsupported_googledrive_file(t),i.push(o)):t.mimeType&&t.mimeType.match(/msword|wordprocessing|pdf|plain|docx|\.text|octet|google-apps\.document/i)?(o=build_googledrive_file(t),i.push(o)):(o=build_unsupported_googledrive_file(t),i.push(o))}),$picker.text(""),$.each(i,function(e,o){$picker.append(o)}),generate_googledrive_breadcrumbs(),i.length<1&&show_error(googledrive_prev_folder.length>1?"We couldn't find any documents in this folder":"We couldn't find any documents in your GoogleDrive account"))}function build_googledrive_folder(e){var o=e.title,i=create_element("h3","","googledrive-folder-title").text(o),t=create_element("span","","filepicker-thumb").html('<img src="//static.cv-library.co.uk/images/filepicker-folder-thumb.png">'),r=create_element("div","","googledrive-folder").data({folder_path:e.id,folder_name:e.title});return r.append(t,i),r}function build_googledrive_file(e){var o;o=e.downloadUrl?e.downloadUrl+"#filename="+escape(e.originalFilename)+"#token="+escape("Bearer "+googledrive_access_token):e.exportLinks["application/vnd.openxmlformats-officedocument.wordprocessingml.document"]+"#filename="+escape(e.title)+"#token="+escape("Bearer "+googledrive_access_token);var i=e.title.split(".").pop(),t=create_element("div","","google-doc").data({download_link:o,name:e.title,size:e.fileSize}),r=googledrive_thumbnails[i]?googledrive_thumbnails[i]:googledrive_thumbnails.doc,n=$("<img>",{src:encodeURI("/images/"+r+".png")}),a=create_element("span","","filepicker-thumb").html(n),d=create_element("h3","","google-doc-title").text(e.title),c=create_element("span","","filepicker-checkbox"),l=e.modifiedDate,s=l.split("T").shift();s=s.split("-"),s.reverse();var p=s.join("-"),_=create_element("p","","google-doc-date").text("Last modified: "+p);return t.append(a,d,_,c),t}function build_unsupported_googledrive_file(e){var o=create_element("div","","google-doc unsupported"),i=create_element("span","","filepicker-thumb").html('<img src="//static.cv-library.co.uk/images/filepicker-unsupported-thumb.png">'),t=create_element("span","","filepicker-unsupported").text("We don't support this file type"),r=create_element("h3","","google-doc-title").text(e.title),n=e.modifiedDate,a=n.split("T").shift();a=a.split("-"),a.reverse();var d=a.join("-"),c=create_element("p","","google-doc-date").text("Last modified: "+d);return o.append(i,r,c,t),o}function generate_googledrive_breadcrumbs(){$breadcrumbs.text(""),$.each(googledrive_prev_folder,function(e,o){var i=e>0?o.name:"GoogleDrive",t=$("<span>",{"data-index":e,"class":"filepicker-breadcrumb"}).text(i);e>0&&$breadcrumbs.append("<span>&gt</span>"),$breadcrumbs.append(t)})}function logout_googledrive(){googledrive_access_token=null,window.localStorage.removeItem("cvl_googledrive_access_token"),show_loading_div("Logging out from Google Drive");var e=create_element("iframe","","logout-frame").attr("src","https://accounts.google.com/logout");e.on("load",function(){$(this).remove(),hide_loading_div(),hide_popup()}),$("body").append(e)}function open_onedrive_picker(e){auth_window&&auth_window.close(),onedrive_access_token=e,window.localStorage.cvl_onedrive_access_token=e,get_onedrive_list_json()}function onedrive_picker_denied(){auth_window&&auth_window.close(),alert("Please allow CV-Library access to your Onedrive file list in order to upload your CV via Onedrive")}function get_onedrive_user_info(){var e=$.Deferred();return $.ajax({url:"https://apis.live.net/v5.0/me?access_token="+onedrive_access_token,type:"GET",success:function(o){add_filepicker_user_info(o.name,o.emails.account),have_onedrive_account_info=!0,e.resolve()},error:function(o){console.log(o),e.resolve()}}),e}function get_onedrive_list_json(e){var o;o=e&&""!=e?"https://apis.live.net/v5.0/"+e+"/files?access_token="+onedrive_access_token:"https://apis.live.net/v5.0/me/skydrive?access_token="+onedrive_access_token,show_loading_div("Loading documents"),$.ajax({url:o,dataType:"json",method:"GET",success:function(e){e.id?(onedrive_prev_folder.push({path:e.id,name:" "}),get_onedrive_list_json(e.id)):(generate_onedrive_file_list(e.data),onedrive_prev_folder.length<2?($breadcrumbs.hide(),$picker.addClass("first-page")):($breadcrumbs.show(),$picker.removeClass("first-page")),have_onedrive_account_info?hide_loading_div():get_onedrive_user_info().done(function(){hide_loading_div()}))},error:function(){hide_loading_div(),onedrive_access_token?auth_window=window.open(onedrive_auth_url,"",auth_window_options):alert("There was an error retrieving your OneDrive documents. Please try again.")}})}function generate_onedrive_file_list(e){var o=[];$.each(e,function(e,i){if("folder"==i.type){var t=build_onedrive_folder(i);o.push(t)}else if("file"==i.type){var r,n=i.name.split(".").pop(),a=i.name.split(".").shift();Valid.IsInvalidCV(a)?(r=build_unsupported_dropbox_file(i),o.push(r)):n&&(n.match(/^(pdf|txt|rtf|doc|docx|odt|wps)$/i)?(r=build_onedrive_file(i),o.push(r)):(r=build_unsupported_onedrive_file(i),o.push(r)))}}),$picker.text(""),$.each(o,function(e,o){$picker.append(o)}),generate_onedrive_breadcrumbs(),o.length<1&&show_error(onedrive_prev_folder.length>1?"We couldn't find any documents in this folder":"We couldn't find any documents in your OneDrive account")}function generate_onedrive_breadcrumbs(){$breadcrumbs.text(""),$.each(onedrive_prev_folder,function(e,o){var i=e>0?o.name:"OneDrive",t=$("<span>",{"data-index":e,"class":"filepicker-breadcrumb"}).text(i);e>0&&$breadcrumbs.append("<span>&gt</span>"),$breadcrumbs.append(t)})}function build_onedrive_folder(e){var o=create_element("h3","","onedrive-folder-title").text(e.name),i=create_element("span","","filepicker-thumb").html('<img src="//static.cv-library.co.uk/images/filepicker-folder-thumb.png">'),t=create_element("div","","onedrive-folder").data({folder_path:e.id,folder_name:e.name});return t.append(i,o),t}function build_onedrive_file(e){var o=e.name.split(".").pop(),i=create_element("h3","","onedrive-doc-title").text(e.name),t=$("<img>",{src:encodeURI("/images/"+onedrive_thumbnails[o]+".png")}),r=create_element("span","","filepicker-thumb").html(t),n=create_element("span","","filepicker-checkbox"),a=e.updated_time,d=a.split("T").shift();d=d.split("-"),d.reverse();var c=d.join("-"),l=create_element("p","","onedrive-doc-date").text("Last modified: "+c),s=create_element("div","","onedrive-doc").data({download_link:e.source,parent_path:e.parent_id,name:e.name});return s.append(r,i,l,n),s}function build_unsupported_onedrive_file(e){var o=create_element("h3","","onedrive-doc-title").text(e.name),i=create_element("span","","filepicker-thumb").html('<img src="//static.cv-library.co.uk/images/filepicker-unsupported-thumb.png">'),t=create_element("span","","filepicker-unsupported").text("We don't support this file type"),r=e.updated_time,n=r.split("T").shift();n=n.split("-"),n.reverse();var a=n.join("-"),d=create_element("p","","onedrive-doc-date").text("Last modified: "+a),c=create_element("div","","onedrive-doc unsupported");return c.append(i,o,d,t),c}function logout_onedrive(){onedrive_access_token=null,window.localStorage.removeItem("cvl_onedrive_access_token"),show_loading_div("Logging out from OneDrive");var e=$(document.createElement("iframe")).attr({"class":"logout-frame",src:"https://login.live.com/logout.srf"});e.on("load",function(){$(this).remove(),hide_loading_div(),hide_popup()}),$("body").append(e)}function show_mjm_revert(){$("#cv_mjm").val()&&(MJM_cv||(MJM_cv=$("#cv_mjm").val()),$("#cv_mjm").val(""),$("#revert-to-mjm-cv").show(),$(".mjm-change-wrap").hide())}function resetFilepicker(){set_file_name(""),$("#cv_name_nice").val(""),activeFilePicker&&(resetFormElement(activeFilePicker.$file_input),activeFilePicker.$dropbox_url.val(""),activeFilePicker.$onedrive_url.val(""),activeFilePicker.$googledrive_url.val(""))}function resetFormElement(e,o){var i=e.clone(!0);e===activeFilePicker.$file_input&&(activeFilePicker.$file_input=i),e.replaceWith(i),i.val(""),(window.location.pathname.match("/apply")||window.location.pathname.match("/job/")&&"undefined"!=typeof switch_save_to_profile)&&($("#cloud_file_name").val(o),switch_save_to_profile())}function is_reg_page(){return/\/register/.test(location.pathname)}function is_offer_page(){return/\/candidate-offer/.test(location.pathname)}function is_mobile(){return $("#mobile-icons").is(":visible")}function hide_upload_later(){var e=$(".upload-cv-later-row");e.length&&e.hide()}function set_file_name(e,o){var i=o||activeFilePicker;i.$file_chosen.text("File chosen: "+e),i.$file_chosen.css("color",e?"#219a00":"#444"),i.$dropdown_toggle&&i.$dropdown_toggle.text(e||"Upload your CV")}var redirect_url="https://"+window.location.hostname,box_redirect_uri=redirect_url+"/filepicker-box-auth.html",box_auth_url="https://account.box.com/api/oauth2/authorize?response_type=code&client_id="+box_client_id+"&redirect_uri="+box_redirect_uri,dropbox_redirect_uri=redirect_url+"/filepicker-dropbox-auth.html",dropbox_auth_url="https://www.dropbox.com/oauth2/authorize?client_id="+dropbox_client_id+"&response_type=token&redirect_uri="+dropbox_redirect_uri,google_redirect_uri=redirect_url+"/filepicker-googledrive-auth.html",googledrive_auth_url="https://accounts.google.com/o/oauth2/auth?redirect_uri="+google_redirect_uri+"&response_type=token&client_id="+google_client_id+"&scope=https://www.googleapis.com/auth/drive%20https://www.googleapis.com/auth/userinfo.email%20https://www.googleapis.com/auth/userinfo.profile&include_granted_scopes=true",onedrive_redirect_uri=redirect_url+"/filepicker-onedrive-auth.html",onedrive_auth_url="https://login.live.com/oauth20_authorize.srf?client_id="+onedrive_client_id+"&scope=wl.signin%20wl.skydrive%20wl.emails&response_type=token&display=touch&redirect_uri="+onedrive_redirect_uri,filepickers={},activeFilePicker,$overlay,$popup,$picker,$breadcrumbs,$display,$view_list,$view_icons,$loading_div,$picker_top,$user_info,$user_info_name,$user_info_arrow,$user_info_dropdown,$user_info_dropdown_email,$logout,$picker_bottom,$close_popup,$choose_file;$(function(){function e(e){this.init(e)}e.prototype.init=function(e){this.$element=$(e),this.id=e.getAttribute("id"),this.is_dropdown_filepicker=e.hasAttribute("data-dropdown-filepicker"),this.include_supported_text=e.hasAttribute("data-dropdown-filepicker-supported"),this.$box_url=$('[data-cv-input="box"][data-filepicker="'+this.id+'"]'),this.$dropbox_url=$('[data-cv-input="dropbox"][data-filepicker="'+this.id+'"]'),this.$file_input=$('[data-cv-input="device"][data-filepicker="'+this.id+'"]'),this.$googledrive_url=$('[data-cv-input="googledrive"][data-filepicker="'+this.id+'"]'),this.$onedrive_url=$('[data-cv-input="onedrive"][data-filepicker="'+this.id+'"]'),this.constructHTML(),this.addEventListeners()},e.prototype.constructHTML=function(){if(this.$button_wrapper=create_element("div","","filepicker-buttons").data("filepicker",this),!$(".british-jobs").length&&!$(".industry-jobs").length&&(this.$box_btn=create_element("button","filepicker-box").html('<img src="//static.cv-library.co.uk/images/candidate/icon-box.svg" alt="">Box').attr({type:"button","data-action":"cloud-upload"}).data("picker","box"),this.$dropbox_btn=create_element("button","filepicker-dropbox").html('<img src="//static.cv-library.co.uk/images/candidate/icon-dropbox.svg" alt="">Dropbox').attr({type:"button","data-action":"cloud-upload"}).data("picker","dropbox"),this.$googledrive_btn=create_element("button","filepicker-googledrive").html('<img src="//static.cv-library.co.uk/images/candidate/icon-google-drive.svg" alt="">Google Drive').attr({type:"button","data-action":"cloud-upload"}).data("picker","googledrive"),this.$onedrive_btn=create_element("button","filepicker-onedrive").html('<img src="//static.cv-library.co.uk/images/filepicker-onedrive-icon-btn.png" alt="">OneDrive').attr({type:"button","data-action":"cloud-upload"}).data("picker","onedrive"),this.$device_btn=create_element("button","filepicker-device").attr("type","button").data("picker","device"),is_mobile()?this.$device_btn.html('<img src="//static.cv-library.co.uk/images/candidate/icon-device.svg" alt="">Device'):this.$device_btn.html('<img src="//static.cv-library.co.uk/images/candidate/icon-device-desktop.svg" alt=""> Device'),this.include_device_button=this.is_dropdown_filepicker||is_mobile()&&(is_reg_page()||is_offer_page()),this.is_dropdown_filepicker&&(this.$dropdown_toggle=create_element("button","","filepicker-dropdown__toggle").attr({type:"button","aria-expanded":"false"}).text("Upload your CV")),this.include_device_button&&this.$button_wrapper.append(this.$device_btn),this.$button_wrapper.append(this.$dropbox_btn,this.$googledrive_btn,this.$box_btn),this.is_dropdown_filepicker&&this.include_supported_text)){var e=$("<p>",{"class":"filepicker-dropdown__info",text:".doc, .docx, .rtf, .txt, .odt, .pdf and .wps"});e.prepend($("<span>",{text:"Supported files:"})),this.$button_wrapper.append(e)}this.$file_chosen=create_element("p","","filepicker-file-chosen").text("No file chosen"),this.$dropdown_toggle?this.$element.after(create_element("div","","filepicker-dropdown").append(this.$dropdown_toggle,this.$button_wrapper,this.$file_chosen)):this.$element.after(this.$button_wrapper,this.$file_chosen)},e.prototype.addEventListeners=function(){this.$file_input.on("change",function(){this.$box_url.val(""),this.$dropbox_url.val(""),this.$googledrive_url.val(""),this.$onedrive_url.val(""),set_file_name("",this),$("#cv_mjm")[0]&&show_mjm_revert(),hide_upload_later()}.bind(this)),this.$device_btn&&this.$device_btn.on("click",function(){this.$file_input.trigger("click")}.bind(this)),(is_reg_page()||is_offer_page())&&this.$file_input.on("change",function(e){is_mobile()&&(set_file_name(e.target.value.split("\\").pop(),this),hide_upload_later())}.bind(this)),this.$dropdown_toggle&&this.$file_input.on("change",function(e){set_file_name(e.target.value.split("\\").pop(),this)}.bind(this))},$('[id="filepicker"], div[data-filepicker]').each(function(){var o=new e(this);filepickers[this.getAttribute("id")]=o,activeFilePicker||(activeFilePicker=o)}),$overlay=create_element("div","filepicker-overlay"),$popup=create_element("div","filepicker-popup"),$picker=create_element("div","filepicker-contents"),$breadcrumbs=create_element("div","filepicker-breadcrumbs"),$display=create_element("div","filepicker-display"),$view_list=create_element("div","","filepicker-view-list").html("<span></span><span></span><span></span>").addClass("selected"),$view_icons=create_element("div","","filepicker-view-icons").html("<span></span><span></span><span></span><span></span>"),$loading_div=create_element("div","filepicker-loading-div").html('<img src="//static.cv-library.co.uk/images/filepicker-loader.gif"><p></p>'),$picker_top=create_element("div","filepicker-top").html('<span></span><h3>Select CV from <span id="filepicker-picker"></span></h3>'),$user_info=create_element("div","filepicker-userinfo"),$user_info_name=create_element("p"),$user_info_arrow=create_element("img").attr("src","//static.cv-library.co.uk/images/filepicker-dropdown-icon.png"),$user_info_dropdown=create_element("div","filepicker-userinfo-dropdown"),$user_info_dropdown_email=create_element("p","filepicker-userinfo-dropdown-email"),$logout=create_element("span","filepicker-logout").text("Sign out"),$picker_bottom=create_element("div","filepicker-bottom"),$close_popup=create_element("span","filepicker-close").text("Cancel"),$choose_file=create_element("span","filepicker-choose").text("Choose File"),$user_info_dropdown.append($user_info_dropdown_email,$logout),$user_info.append($user_info_name,$user_info_arrow,$user_info_dropdown),$picker_top.append($user_info),$picker_bottom.append($close_popup,$choose_file),$display.append($view_list,$view_icons),$overlay.append($popup.append($picker_top,$breadcrumbs,$display,$picker,$picker_bottom,$loading_div)),window.localStorage.cvl_box_access_token&&check_box_access_token(window.localStorage.cvl_box_access_token),window.localStorage.cvl_dropbox_access_token&&check_dropbox_access_token(window.localStorage.cvl_dropbox_access_token),window.localStorage.cvl_googledrive_access_token&&check_googledrive_access_token(window.localStorage.cvl_googledrive_access_token),window.localStorage.cvl_onedrive_access_token&&check_onedrive_access_token(window.localStorage.cvl_onedrive_access_token)});var auth_window,auth_window_options,fp_picker_using,opening_cloud="0";$(function(){var e=($(window).width()-800)/2,o=($(window).height()-600)/2;auth_window_options="height=600,width=800,location=no,menubar=no,toolbar=no,top="+o+",left="+e+",addressbar=0"});var box_access_token,dropbox_access_token,googledrive_access_token,onedrive_access_token,have_box_account_info=!1,have_dropbox_account_info=!1,have_googledrive_account_info=!1,have_onedrive_account_info=!1,box_prev_folder=[],dropbox_prev_path=[],onedrive_prev_folder=[],googledrive_prev_folder=[],dropbox_thumbnails={doc:"filepicker-doc-thumb",odt:"filepicker-odt-thumb",wps:"filepicker-wps-thumb",pdf:"filepicker-pdf-thumb",rtf:"filepicker-rtf-thumb",txt:"filepicker-txt-thumb",docx:"filepicker-docx-thumb"},googledrive_items=[],googledrive_thumbnails={doc:"filepicker-doc-thumb",docx:"filepicker-docx-thumb",odt:"filepicker-odt-thumb",wps:"filepicker-wps-thumb",pdf:"filepicker-pdf-thumb",rtf:"filepicker-rtf-thumb",txt:"filepicker-txt-thumb"},onedrive_thumbnails={doc:"filepicker-doc-thumb",docx:"filepicker-docx-thumb",odt:"filepicker-odt-thumb",wps:"filepicker-wps-thumb",pdf:"filepicker-pdf-thumb",rtf:"filepicker-rtf-thumb",txt:"filepicker-txt-thumb"},MJM_cv;$(function(){var e=$("#filepicker-css");e.length?e.attr("href",e.attr("data-href")).removeAttr("data-href"):$("head").find("link").first().before('<link rel="stylesheet" href="//static.cv-library.co.uk/css/filepicker.css?v=1.3">');var o=filepickers[Object.keys(filepickers)[0]],i=$("#filepicker-popup-target");$overlay.appendTo(i.length?i:o.$element),$display.on("click",function(e){var o=$(e.target).closest("div");switch(o.attr("class")){case"filepicker-view-list":$picker.children().fadeOut(100),setTimeout(function(){$picker.removeClass("icon-view"),$picker.children().fadeIn(100)},100),$(".filepicker-view-icons").removeClass("selected"),o.addClass("selected");break;case"filepicker-view-icons":$picker.children().fadeOut(100),setTimeout(function(){$picker.addClass("icon-view"),$picker.children().fadeIn(100)},100),$(".filepicker-view-list").removeClass("selected"),o.addClass("selected")}}),$user_info.on("click",function(){$user_info_dropdown.toggle()}),$(document).on("click",'button[data-action="cloud-upload"]',function(){var e=$(this);auth_window&&auth_window.close(),opening_cloud="1",open_popup(e.closest(".filepicker-buttons").data("filepicker")),load_picker_auth(e.data("picker"))}).one("click",".filepicker-dropdown",function(){$("#filepicker").prop("hidden",!1)}),$close_popup.on("click",hide_popup),$overlay.on("click",function(e){var o=$(e.target).attr("id");"filepicker-close"!=o&&"filepicker-overlay"!=o||hide_popup()}),$picker.on("click",function(e){var o=$(e.target).closest("div");switch(o.attr("class")){case"box-doc":case"dropbox-doc":case"google-doc":case"onedrive-doc":$(".box-doc.selected, .dropbox-doc.selected, .google-doc.selected, .onedrive-doc.selected").removeClass("selected"),o.addClass("selected");var i=o.data("download_link"),t=o.data("name"),r=o.data("size");$choose_file.data({name:t,path:i,size:r}).addClass("filepicker-chosen");break;case"box-doc selected":case"dropbox-doc selected":case"google-doc selected":case"onedrive-doc selected":o.removeClass("selected"),$choose_file.data({name:"",path:""}).removeClass("filepicker-chosen");break;case"box-folder":get_box_list_json(o.data("folder_path"),o.data("folder_name"));break;case"dropbox-folder":get_dropbox_list_json(o.data("path"));break;case"onedrive-folder":var n=o.data("folder_path"),a=o.data("folder_name");onedrive_prev_folder.push({path:n,name:a}),get_onedrive_list_json(n);break;case"googledrive-folder":var d=o.data("folder_path"),c=o.data("folder_name");googledrive_prev_folder.push({path:d,name:c}),get_googledrive_list_json(!1,d);break;case"box-doc unsupported":case"dropbox-doc unsupported":case"google-doc unsupported":case"onedrive-doc unsupported":o.children(".filepicker-unsupported").is(":visible")||o.children(".filepicker-unsupported").fadeIn(300).delay(3e3).fadeOut(300)}}),$logout.on("click",function(){"box"==fp_picker_using?logout_box():onedrive_prev_folder.length?logout_onedrive():dropbox_prev_path.length?logout_dropbox():logout_googledrive()}),$choose_file.on("click",function(){var e=$(this);e.hasClass("filepicker-chosen")&&("box"==fp_picker_using?(box_prev_folder=[],resetFormElement(activeFilePicker.$file_input,e.data("name")),activeFilePicker.$box_url.val(e.data("path")).data("size",e.data("size")).trigger("change"),set_file_name(e.data("name")),hide_popup(),hide_upload_later()):dropbox_prev_path.length?fetch_dropbox_download_link(e.data("path"),e.data("name")):onedrive_prev_folder.length?(onedrive_prev_folder=[],activeFilePicker.$dropbox_url.val(""),activeFilePicker.$googledrive_url.val(""),resetFormElement(activeFilePicker.$file_input,e.data("name")),activeFilePicker.$onedrive_url.val(e.data("path")).data("size",e.data("size")).trigger("change"),set_file_name(e.data("name")),$("#cv_name_nice").val(e.data("name")),hide_popup(),hide_upload_later()):(activeFilePicker.$dropbox_url.val(""),activeFilePicker.$onedrive_url.val(""),resetFormElement(activeFilePicker.$file_input,e.data("name")),activeFilePicker.$googledrive_url.val(e.data("path")).data("size",e.data("size")).trigger("change"),set_file_name(e.data("name")),$("#cv_name_nice").val(e.data("name")),hide_popup(),hide_upload_later())),$("#cv_mjm")[0]&&show_mjm_revert()}),$breadcrumbs.on("click",function(e){var o=$(e.target);switch(o.attr("class")){case"filepicker-breadcrumb":if(!o.is(":last-child")){var i,t=o.data("index"),r="box"==fp_picker_using,n=dropbox_prev_path.length>0,a=onedrive_prev_folder.length>0;if(r){i=box_prev_folder[t].path;var d=box_prev_folder[t].name;box_prev_folder.splice(t,box_prev_folder.length),get_box_list_json(i,d)}else n?(i=dropbox_prev_path[t],dropbox_prev_path.splice(t,dropbox_prev_path.length),get_dropbox_list_json(i)):a?(i=onedrive_prev_folder[t].path,onedrive_prev_folder.splice(parseInt(t+1),onedrive_prev_folder.length),get_onedrive_list_json(i)):(i=googledrive_prev_folder[t].path,googledrive_prev_folder.splice(parseInt(t+1),googledrive_prev_folder.length),get_googledrive_list_json(!1,i))}}});var t=$(".filepicker-dropdown__toggle");if(t.length){$(document).on("click",function(e){t.attr("aria-expanded",function(){return e.target===this&&"true"!==this.getAttribute("aria-expanded")})});var r=$(".filepicker-buttons button");$(".filepicker-dropdown").on("keydown",function(e){var o=$(this).find(".filepicker-dropdown__toggle");if(38===e.keyCode||40===e.keyCode){e.preventDefault(),o.attr("aria-expanded","true");var i=38===e.keyCode?-1:1,t=r.index(e.target),n=-1===t?0:t+i,a=r.eq(n);n>-1&&a.length&&a.trigger("focus")}else 27===e.keyCode&&o.attr("aria-expanded","false")})}var n=navigator.userAgent,a=n.match(/Windows Phone ([^;]+);/i);if(a&&a[1]<8.1){var d=create_element("div","","userBoxIconSmall750").html("<p>Sorry, your device doesnt support native file selection.</p>").css("margin-top","10px");$.each(filepickers,function(e,o){o.$file_input.after(d.clone()),o.$file_input.hide()})}var c=filepickers.filepicker;c&&(c.$box_url.val()||c.$dropbox_url.val()||c.$googledrive_url.val()||c.$onedrive_url.val())&&(set_file_name($("#cv_name_nice").val(),c),$("#toggle-cloud").trigger("click"),hide_upload_later())});